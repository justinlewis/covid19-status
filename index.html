<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>COVID-19 Status - Colorado</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="As live as we can get data visualization for COVID-19 in Colorado.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="twitter:title" content="COVID-19 Status - Colorado">
    <meta name="twitter:description" content="As live as we can get data visualization for COVID-19 in Colorado.">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <script src="assets/L.LabelTextCollision.js"></script>

    <script src="data/colorado-counties.js"></script>
    <script src="data/colorado.js"></script>

    <style>
      html, body {
        font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
        /* height: 100vh; */
        margin: 0;
        padding-top: 28px;
      }

      .container-fluid {
        /* height: 100%; */
      }

      .row.map-container {
        /* height: 100%; */
        /* height: 100vh; */
        height: calc(100vh - 56px);
      }
      .row.map-container > div {
        padding: 0;
      }

      #map {
        width: 100%;
        height: 100%;
      }

    </style>
  </head>

  <body>
    <!-- <a href="https://github.com/justinlewis/covid19-status-colorado"><img class="z-max" style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a> -->

    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">COVID-19 Status - Colorado</a>
    </nav>

    <div class="container-fluid">

      <div class="row map-container">
        <div class="col-sm">
          <!-- <h1 class="f3 ma0">COVID-19 Status - Colorado</h1> -->
          <div id="map" class="map"></div>
        </div>
      </div>

    </div>

    <script>

      var labelTextCollision = new L.LabelTextCollision({collisionFlg : true});

    	var map = L.map('map').setView([39.115145, -105.804618], 7);

    	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    		maxZoom: 18,
    		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
    			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    		id: 'mapbox/streets-v11',
    		tileSize: 512,
    		zoomOffset: -1
    	}).addTo(map);


      // Attach case count to counties
      counties.features.forEach((cty, i) => {
        if(coloradocovid.presumed[cty.properties.name]){
          cty.properties.covidcases = coloradocovid.presumed[cty.properties.name];
          console.log(cty.properties.name)
        }
        else{
          cty.properties.covidcases = 0;
        }
      });

      function getColor(d) {
        return d > 200 ? '#800026' :
               d > 100  ? '#BD0026' :
               d > 50  ? '#E31A1C' :
               d > 20  ? '#FC4E2A' :
               d > 10   ? '#FD8D3C' :
               d > 5   ? '#FEB24C' :
               d > 1   ? '#FED976' :
                          'none';
      }

      function style(feature) {
          return {
              fillColor: getColor(feature.properties.covidcases),
              weight: 1,
              opacity: 1,
              color: 'grey',
              fillOpacity: 0.7
          };
      }

      L.geoJSON(counties, {
        style: style,
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<h5>'+feature.properties.name+' County </h5><h5>'+feature.properties.covidcases+' cases presumed positive</h5>');
        }
      }).addTo(map);

    </script>

  </body>
</html>
